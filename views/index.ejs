<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/style.css">
  <title>COMMENT SECTION</title>


</head>
<body>
  <div class="deleteContainer">
    <div class="modal">
      <h2>Delete comment</h2>
      <p>Are you sure you want to delete this comment? This will remove the comment and can't be undone.</p>
      <div>
        <button class="clickable hideModal">NO, CANCEL</button>
        <button class="clickable approveDelete">YES, DELETE</button>
      </div>
    </div>
  </div>
  <main>
<section id="commentSection">
  <% comments.forEach(comment =>{ %>

  <section class="thread">
    <% if (comment.user._id=='63144e8ec1250ba70cc3efbb') { %>
  <section class="comment">
    <div class="upvoter">
      <span class="icon plus clickable"></span>
      <span><%=comment.score%></span>
      <span class="icon minus clickable"></span>
    </div>
    <section class="info">
      <section class="infoTop">
        <div>
          
          <img src="<%=comment.user.image%>">
          <h4><%=comment.user.username%></h4>
          <% if (comment.createdString) { %>
          <span><%= comment.createdString%>  </span>
          <% } else {%>
            <span><%= moment(comment.created).fromNow() %>  </span>
            <% }%>
        </div>
        <div class="action">
          <div class="button clickable deleteButton deleteComment" data-id="<%=comment._id%>">
          <span class="icon delete"></span>
          <span>Delete</span>
          
        </div>
        
        <div class="button clickable editButton">
          <span class="icon edit"></span>
          <span>Edit</span>
        </div>
        </div>
      </section>
      <p><%=comment.content%></p>
    </section>
  </section>
  <% } else {%>
    <section class="comment">
      <div class="upvoter">
        <span class="icon plus clickable"></span>
        <span><%=comment.score%></span>
        <span class="icon minus clickable"></span>
      </div>
      <section class="info">
        <section class="infoTop">
          <div>
            
            <img src="<%=comment.user.image%>">
            <h4><%=comment.user.username%></h4>
            <% if (comment.createdString) { %>
            <span><%= comment.createdString%>  </span>
            <% } else {%>
              <span><%= moment(comment.created).fromNow() %>  </span>
              <% }%>
          </div>
          <div class="action">
            <div class="button clickable replyButton">
            <span class="icon reply"></span>
            <span>Reply</span>
          </div>
          </div>
        </section>
        <p><%=comment.content%></p>
      </section>
    </section>
    <% } %>
  <section class="addComment">
    <div>
      <img src="/images/avatars/image-juliusomo.png" alt="avatar">
    </div>
    <form>
    <textarea type="text" placeholder="Add a comment..."></textarea>
    <button class="clickable">REPLY</button>
  </form>
  </section>
  <% if (comment.replies.length !== 0) { %>
  <% comment.replies.forEach(reply =>{ %>
    <% if (reply.user._id=='63144e8ec1250ba70cc3efbb') { %>
      <section class="replySection">
        <section class="comment">
          <div class="upvoter">
            <span class="icon plus clickable"></span>
            <span><%=reply.score%></span>
            <span class="icon minus clickable"></span>
          </div>
          <section class="info">
            <section class="infoTop">
              <div>
                <img src="/images/avatars/image-juliusomo.png" alt="avatar">
                <h4><%=reply.user.username%></h4>
                <span>you</span>
                <span><%=reply.createdString%></span>
              </div>
              <div class="action">
                <div class="button clickable deleteButton deleteReply" data-id="<%=reply._id%>" data-commentId="<%=comment._id%>">
                <span class="icon delete"></span>
                <span>Delete</span>
              </div>
              <div class="button clickable editButton">
                <span class="icon edit"></span>
                <span>Edit</span>
              </div>
              </div>
            </section>
            <p class="editable"><%=reply.content%></p>
          <section class="updateContainer"><button class="clickable updateButton" data-id="<%=reply._id%>">UPDATE</button></section>
          
          </section>
        </section>
        <section class="addComment">
          <div>
            <img src="/images/avatars/image-juliusomo.png" alt="avatar">
          </div>
          <form>
          <textarea type="text" placeholder="Add a comment..."></textarea>
          <button class="clickable">SEND</button>
        </form>
        </section>
      </section>
  <% } else {%>
    <section class="replySection">
      <section class="comment">
        <div class="upvoter">
          <span class="icon plus clickable"></span>
          <span><%=reply.score%></span>
          <span class="icon minus clickable"></span>
        </div>
        <section class="info">
          <section class="infoTop">
            <div>
              <img src="<%=reply.user.image%>" alt="avatar">
              <h4><%=reply.user.username%></h4>
              <span>1 month ago</span>
            </div>
            <div class="action">
              <div class="button clickable replyButton">
              <span class="icon reply"></span>
              <span>Reply</span>
            </div>
            </div>
          </section>
          <p><%=reply.content%></p>
        </section>
      </section>
      <section class="addComment">
        <div>
          <img src="/images/avatars/image-juliusomo.png" alt="avatar">
        </div>
        <form>
        <textarea type="text" placeholder="Add a comment..."></textarea>
        <button class="clickable">SEND</button>
      </form>
      </section>
    </section>
    <% }%>
  <% })%>
  <% }%>
</section>

<% })%>
  <section class="leaveComment">
    <div>
      <img src="/images/avatars/image-juliusomo.png" alt="avatar">
    </div>
    <form method="post" action="/add-comment">
    <textarea type="text" placeholder="Add a comment..." name="content"></textarea>
    <button class="clickable">SEND</button>
  </form>
  </section>
</section>

</main>
<script src="js/main.js"></script>
</body>
</html>