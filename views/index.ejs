<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/style.css">
  <title>COMMENT SECTION</title>


</head>
<body>
  <div class="deleteContainer">
    <div class="modal">
      <h2>Delete comment</h2>
      <p>Are you sure you want to delete this comment? This will remove the comment and can't be undone.</p>
      <div>
        <button class="clickable hideModal">NO, CANCEL</button>
        <button class="clickable approveDelete">YES, DELETE</button>
      </div>
    </div>
  </div>
  <main>
<section id="commentSection">
  <% comments.forEach(comment =>{ %>

  <section class="thread">
    <% if (comment.user._id=='63144e8ec1250ba70cc3efbb') { %>
  <section class="comment">
    <section class="mobile">
    <div class="upvoter" data-commentid="<%=comment._id%>">
      <% if (comment.upvoted) { %>
      <span class="icon plus clickable upvote selected"></span>
      <% } else {%>
        <span class="icon plus clickable upvote"></span>
        <% }%>
      <span class="score"><%=comment.score%></span>
      <% if (comment.downvoted) { %>
        <span class="icon minus clickable upvote selected"></span>
        <% } else {%>
          <span class="icon minus clickable upvote"></span>
          <% }%>
    </div>
    <div class="actionMobile">
      <div class="button clickable deleteButton deleteComment" data-id="<%=comment._id%>">
      <span class="icon delete"></span>
      <span>Delete</span>
      
    </div>
    
    <div class="button clickable editButton editComment" data-id="<%=comment._id%>">
      <span class="icon edit"></span>
      <span>Edit</span>
    </div>
    </div>
  </section>
    <section class="info">
      <section class="infoTop">
        <div>
          
          <img src="<%=comment.user.image%>" alt="avatar">
          <h4><%=comment.user.username%></h4>
          <span class="you">you</span>
          <% if (comment.createdString) { %>
          <span class="created"><%= comment.createdString%>  </span>
          <% } else {%>
            <span class="created"><%= moment(comment.created).fromNow() %>  </span>
            <% }%>
        </div>
        <div class="action">
          <div class="button clickable deleteButton deleteComment" data-id="<%=comment._id%>">
          <span class="icon delete"></span>
          <span>Delete</span>
          
        </div>
        
        <div class="button clickable editButton editComment" data-id="<%=comment._id%>">
          <span class="icon edit"></span>
          <span>Edit</span>
        </div>
        </div>
      </section>
      <p class="editable"><%=comment.content%></p>
      <form class="editForm" >
        <textarea class="textarea"></textarea>
        <section class="updateContainer"><button class="clickable updateButton" data-id="<%=comment._id%>">UPDATE</button></section>
      </form>
    </section>
  </section>
  <% } else {%>
    <section class="comment">
      <section class="mobile">
      <div class="upvoter" data-commentid="<%=comment._id%>">
        <% if (comment.upvoted) { %>
          <span class="icon plus clickable upvote selected"></span>
          <% } else {%>
            <span class="icon plus clickable upvote"></span>
            <% }%>
        <span class="score"><%=comment.score%></span>
        <% if (comment.downvoted) { %>
          <span class="icon minus clickable upvote selected"></span>
          <% } else {%>
            <span class="icon minus clickable upvote"></span>
            <% }%>
       
      </div>
      <div class="actionMobile">
        <div class="button clickable replyButton">
        <span class="icon reply"></span>
        <span>Reply</span>
      </div>
      </div>
    </section>
      <section class="info">
        <section class="infoTop">
          <div>
            
            <img src="<%=comment.user.image%>" alt="avatar">
            <h4><%=comment.user.username%></h4>
            <% if (comment.createdString) { %>
            <span class="created"><%= comment.createdString%>  </span>
            <% } else {%>
              <span class="created"><%= moment(comment.created).fromNow() %>  </span>
              <% }%>
          </div>
          <div class="action">
            <div class="button clickable replyButton">
            <span class="icon reply"></span>
            <span>Reply</span>
          </div>
          </div>
        </section>
        <p><%=comment.content%></p>
      </section>
    </section>
    <% } %>
  <section class="addComment">
    <div>
      <img src="/images/avatars/image-juliusomo.png" alt="avatar">
    </div>
    <form method="post" action="<%=comment.user._id%>/<%=comment._id%>/add-reply">
    <textarea placeholder="@<%=comment.user.username%>" name="content"></textarea>
    <button class="clickable">REPLY</button>
  </form>
  </section>
  <% if (comment.replies.length !== 0) { %>
  <% comment.replies.forEach(reply =>{ %>
    <% if (reply.user._id=='63144e8ec1250ba70cc3efbb') { %>
      <section class="replySection">
        <section class="comment">
          <section class="mobile">
          <div class="upvoter" data-replyid="<%=reply._id%>">
            <% if (reply.upvoted) { %>
              <span class="icon plus clickable upvote selected"></span>
              <% } else {%>
                <span class="icon plus clickable upvote"></span>
                <% }%>
              <span class="score"><%=reply.score%></span>
              <% if (reply.downvoted) { %>
                <span class="icon minus clickable upvote selected"></span>
                <% } else {%>
                  <span class="icon minus clickable upvote"></span>
                  <% }%>
          </div>
          <div class="actionMobile">
            <div class="button clickable deleteButton deleteReply" data-id="<%=reply._id%>" data-commentId="<%=comment._id%>">
            <span class="icon delete"></span>
            <span>Delete</span>
          </div>
          <div class="button clickable editButton editReply" data-id="<%=reply._id%>">
            <span class="icon edit"></span>
            <span>Edit</span>
          </div>
          </div>
        </section>
          <section class="info">
            <section class="infoTop">
              <div>
                <img src="/images/avatars/image-juliusomo.png" alt="avatar">
                <h4><%=reply.user.username%></h4>
                <span class="you">you</span>
                <% if (reply.createdString) { %>
                  <span class="created"><%= reply.createdString%>  </span>
                  <% } else {%>
                    <span class="created"><%= moment(reply.created).fromNow() %>  </span>
                    <% }%>
              </div>
              <div class="action">
                <div class="button clickable deleteButton deleteReply" data-id="<%=reply._id%>" data-commentId="<%=comment._id%>">
                <span class="icon delete"></span>
                <span>Delete</span>
              </div>
              <div class="button clickable editButton editReply" data-id="<%=reply._id%>">
                <span class="icon edit"></span>
                <span>Edit</span>
              </div>
              </div>
            </section>
            <p class="editable"><span class="userTag">@<%=reply.replyingTo.username%></span> <span class="mainText"><%=reply.content%></span> </p>
            <form class="editForm" >
              <textarea class="textarea"></textarea>
              <section class="updateContainer"><button class="clickable updateButton" data-id="<%=reply._id%>">UPDATE</button></section>
            </form>
          
          
          </section>
        </section>
        <section class="addComment">
          <div>
            <img src="/images/avatars/image-juliusomo.png" alt="avatar">
          </div>
          <form>
          <textarea placeholder="Add a comment..."></textarea>
          <button class="clickable">SEND</button>
        </form>
        </section>
      </section>
  <% } else {%>
    <section class="replySection">
      <section class="comment">
        <section class="mobile">
        <div class="upvoter" data-replyid="<%=reply._id%>">
          <% if (reply.upvoted) { %>
            <span class="icon plus clickable upvote selected"></span>
            <% } else {%>
              <span class="icon plus clickable upvote"></span>
              <% }%>
            <span class="score"><%=reply.score%></span>
            <% if (reply.downvoted) { %>
              <span class="icon minus clickable upvote selected"></span>
              <% } else {%>
                <span class="icon minus clickable upvote"></span>
                <% }%>
        </div>
        <div class="actionMobile">
          <div class="button clickable replyButton">
          <span class="icon reply"></span>
          <span>Reply</span>
        </div>
        </div>
      </section>
        <section class="info">
          <section class="infoTop">
            <div>
              <img src="<%=reply.user.image%>" alt="avatar">
              <h4><%=reply.user.username%></h4>
              <% if (reply.createdString) { %>
                <span class="created"><%= reply.createdString%>  </span>
                <% } else {%>
                  <span class="created"><%= moment(reply.created).fromNow() %>  </span>
                  <% }%>
            </div>
            <div class="action">
              <div class="button clickable replyButton">
              <span class="icon reply"></span>
              <span>Reply</span>
            </div>
            </div>
          </section>
          <p><span class="userTag">@<%=reply.replyingTo.username%> </span> <span class="mainText"><%=reply.content%></span></p>
        </section>
      </section>
      <section class="addComment">
        <div>
          <img src="/images/avatars/image-juliusomo.png" alt="avatar">
        </div>
        <form method="post" action="<%=reply.user._id%>/<%=comment._id%>/add-reply">
        <textarea placeholder="@<%=reply.user.username%>" name="content"></textarea>
        <button class="clickable">REPLY</button>
      </form>
      </section>
    </section>
    <% }%>
  <% })%>
  <% }%>
</section>

<% })%>
  <section class="leaveComment">
    <div>
      <img src="/images/avatars/image-juliusomo.png" alt="avatar">
    </div>
    <form method="post" action="/add-comment">
    <textarea placeholder="Add a comment..." name="content"></textarea>
    <button class="clickable">SEND</button>
  </form>
  </section>
</section>

</main>
<script src="js/main.js"></script>
</body>
</html>